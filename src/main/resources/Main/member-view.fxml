<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>

<BorderPane xmlns="http://javafx.com/javafx/17.0.2-ea" xmlns:fx="http://javafx.com/fxml/1" fx:controller="Main.MemberController">
    <top>
        <!-- Header Section -->
        <VBox style="-fx-background-color: #2c3e50; -fx-padding: 20;">
            <HBox alignment="CENTER_LEFT" spacing="20.0">
                <Label fx:id="welcomeLabel" text="Welcome, Member" textFill="WHITE">
                    <font>
                        <Font name="System Bold" size="24.0" />
                    </font>
                </Label>
                <Region HBox.hgrow="ALWAYS" />
                <!-- Back Button (Initially Hidden) -->
                <Button fx:id="backButton" mnemonicParsing="false" onAction="#handleBackToDashboard" style="-fx-background-color: #95a5a6; -fx-text-fill: white; -fx-padding: 10 20; -fx-background-radius: 5;" text="â† Back" visible="false" managed="false" />
                <Button mnemonicParsing="false" onAction="#handleRefresh" style="-fx-background-color: #3498db; -fx-text-fill: white; -fx-padding: 10 20; -fx-background-radius: 5;" text="ðŸ”„ Refresh" />
                <Button mnemonicParsing="false" onAction="#handleLogout" style="-fx-background-color: #e74c3c; -fx-text-fill: white; -fx-padding: 10 20; -fx-background-radius: 5;" text="ðŸšª Logout" />
            </HBox>
        </VBox>
    </top>
    <center>
        <StackPane>
            <!-- Dashboard View (Default) -->
            <VBox fx:id="dashboardView" spacing="30.0" alignment="CENTER">
                <padding>
                    <Insets bottom="50.0" left="50.0" right="50.0" top="50.0" />
                </padding>

                <!-- Welcome Section -->
                <VBox spacing="15.0" alignment="CENTER" style="-fx-background-color: #f8f9fa; -fx-padding: 30; -fx-background-radius: 15; -fx-border-color: #dee2e6; -fx-border-radius: 15;">
                    <Label text="ðŸ“š Library Management System" style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;" />
                    <Label text="Choose an option below to get started" style="-fx-font-size: 16px; -fx-text-fill: #6c757d;" />
                </VBox>

                <!-- Navigation Buttons -->
                <HBox spacing="40.0" alignment="CENTER">
                    <!-- Available Books Button -->
                    <VBox fx:id="availableBooksCard" spacing="15.0" alignment="CENTER" style="-fx-background-color: #e8f5e8; -fx-padding: 30; -fx-background-radius: 15; -fx-border-color: #28a745; -fx-border-radius: 15; -fx-cursor: hand;" onMouseClicked="#handleShowAvailableBooks">
                        <Label text="ðŸ“–" style="-fx-font-size: 48px;" />
                        <Label text="Available Books" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;" />
                        <Label text="Browse and search all books" style="-fx-font-size: 12px; -fx-text-fill: #6c757d; -fx-text-alignment: center;" wrapText="true" />
                    </VBox>

                    <!-- My Books Button -->
                    <VBox fx:id="myBooksCard" spacing="15.0" alignment="CENTER" style="-fx-background-color: #fff3cd; -fx-padding: 30; -fx-background-radius: 15; -fx-border-color: #ffc107; -fx-border-radius: 15; -fx-cursor: hand;" onMouseClicked="#handleShowMyBooks">
                        <Label text="ðŸ“š" style="-fx-font-size: 48px;" />
                        <Label text="My Books" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;" />
                        <Label text="View and return your books" style="-fx-font-size: 12px; -fx-text-fill: #6c757d; -fx-text-alignment: center;" wrapText="true" />
                    </VBox>

                    <!-- Borrow Books Button -->
                    <VBox fx:id="borrowBooksCard" spacing="15.0" alignment="CENTER" style="-fx-background-color: #f0f8ff; -fx-padding: 30; -fx-background-radius: 15; -fx-border-color: #3498db; -fx-border-radius: 15; -fx-cursor: hand;" onMouseClicked="#handleShowBorrowBooks">
                        <Label text="ðŸ“" style="-fx-font-size: 48px;" />
                        <Label text="Borrow Books" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;" />
                        <Label text="Search and borrow books" style="-fx-font-size: 12px; -fx-text-fill: #6c757d; -fx-text-alignment: center;" wrapText="true" />
                    </VBox>
                </HBox>

                <!-- Quick Stats -->
                <HBox spacing="30.0" alignment="CENTER">
                    <VBox spacing="5.0" alignment="CENTER" style="-fx-background-color: #f8f9fa; -fx-padding: 20; -fx-background-radius: 10;">
                        <Label fx:id="totalBooksLabel" text="0" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;" />
                        <Label text="Total Books" style="-fx-font-size: 12px; -fx-text-fill: #6c757d;" />
                    </VBox>
                    <VBox spacing="5.0" alignment="CENTER" style="-fx-background-color: #f8f9fa; -fx-padding: 20; -fx-background-radius: 10;">
                        <Label fx:id="borrowedBooksLabel" text="0" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;" />
                        <Label text="Books Borrowed" style="-fx-font-size: 12px; -fx-text-fill: #6c757d;" />
                    </VBox>
                </HBox>
            </VBox>

            <!-- Available Books View -->
            <VBox fx:id="availableBooksView" spacing="20.0" visible="false" managed="false">
                <padding>
                    <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
                </padding>

                <!-- Search Section -->
                <VBox spacing="15.0" style="-fx-background-color: #f8f9fa; -fx-padding: 25; -fx-background-radius: 10; -fx-border-color: #dee2e6; -fx-border-radius: 10;">
                    <Label text="ðŸ” Search Available Books" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;" />
                    <HBox spacing="20.0" alignment="CENTER_LEFT">
                        <VBox spacing="8.0">
                            <Label text="Book Name:" style="-fx-font-weight: bold; -fx-font-size: 14px;" />
                            <TextField fx:id="searchBookNameField" promptText="Enter book name..." prefWidth="250.0" style="-fx-padding: 10; -fx-background-radius: 5; -fx-font-size: 14px;" />
                        </VBox>
                        <VBox spacing="8.0">
                            <Label text="Genre:" style="-fx-font-weight: bold; -fx-font-size: 14px;" />
                            <TextField fx:id="searchGenreField" promptText="Enter genre..." prefWidth="200.0" style="-fx-padding: 10; -fx-background-radius: 5; -fx-font-size: 14px;" />
                        </VBox>
                        <VBox spacing="8.0" alignment="BOTTOM_LEFT">
                            <Label text=" " />
                            <HBox spacing="15.0">
                                <Button fx:id="searchButton" mnemonicParsing="false" onAction="#handleSearchBooks" style="-fx-background-color: #28a745; -fx-text-fill: white; -fx-padding: 10 20; -fx-background-radius: 5; -fx-font-size: 14px; -fx-font-weight: bold;" text="ðŸ” Search" />
                                <Button fx:id="clearSearchButton" mnemonicParsing="false" onAction="#handleClearSearch" style="-fx-background-color: #6c757d; -fx-text-fill: white; -fx-padding: 10 20; -fx-background-radius: 5; -fx-font-size: 14px;" text="Clear" />
                            </HBox>
                        </VBox>
                    </HBox>
                    <Label fx:id="searchMessageLabel" style="-fx-text-fill: #28a745; -fx-font-weight: bold; -fx-font-size: 14px;" />
                </VBox>

                <!-- Available Books Table -->
                <VBox spacing="10.0" VBox.vgrow="ALWAYS">
                    <Label text="ðŸ“– Available Books" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;" />
                    <TableView fx:id="allBooksTable" style="-fx-background-radius: 10; -fx-border-color: #dee2e6; -fx-border-radius: 10;" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="allBookIdCol" prefWidth="100.0" text="Book ID" />
                            <TableColumn fx:id="allBookTitleCol" prefWidth="250.0" text="Title" />
                            <TableColumn fx:id="allBookAuthorCol" prefWidth="200.0" text="Author" />
                            <TableColumn fx:id="allBookGenreCol" prefWidth="150.0" text="Genre" />
                            <TableColumn fx:id="allBookAvailableCol" prefWidth="100.0" text="Available" />
                            <TableColumn fx:id="allBookRatingCol" prefWidth="80.0" text="Rating" />
                        </columns>
                        <columnResizePolicy>
                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                        </columnResizePolicy>
                    </TableView>
                </VBox>
            </VBox>

            <!-- My Books View -->
            <VBox fx:id="myBooksView" spacing="20.0" visible="false" managed="false">
                <padding>
                    <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
                </padding>

                <Label text="ðŸ“š My Borrowed Books" style="-fx-font-size: 22px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;" />

                <!-- My Books Table -->
                <TableView fx:id="myBooksTable" style="-fx-background-radius: 10; -fx-border-color: #dee2e6; -fx-border-radius: 10;" VBox.vgrow="ALWAYS">
                    <columns>
                        <TableColumn fx:id="myBookIdCol" prefWidth="100.0" text="Book ID" />
                        <TableColumn fx:id="myBookTitleCol" prefWidth="250.0" text="Title" />
                        <TableColumn fx:id="myBookAuthorCol" prefWidth="200.0" text="Author" />
                        <TableColumn fx:id="myBookGenreCol" prefWidth="150.0" text="Genre" />
                        <TableColumn fx:id="myBookRatingCol" prefWidth="100.0" text="Rating" />
                    </columns>
                    <columnResizePolicy>
                        <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                    </columnResizePolicy>
                </TableView>

                <!-- Return Section -->
                <VBox spacing="15.0" style="-fx-background-color: #fff3cd; -fx-padding: 25; -fx-background-radius: 10; -fx-border-color: #ffc107; -fx-border-radius: 10;">
                    <Label text="ðŸ“¤ Return a Book" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;" />
                    <HBox spacing="20.0" alignment="CENTER_LEFT">
                        <VBox spacing="8.0">
                            <Label text="Book ID:" style="-fx-font-weight: bold; -fx-font-size: 14px;" />
                            <TextField fx:id="returnBookIdField" promptText="Enter Book ID to return..." prefWidth="200.0" style="-fx-padding: 10; -fx-background-radius: 5; -fx-font-size: 14px;" />
                        </VBox>
                        <VBox spacing="8.0">
                            <Label text="Rating (0-10):" style="-fx-font-weight: bold; -fx-font-size: 14px;" />
                            <TextField fx:id="ratingField" promptText="Rate the book (optional)..." prefWidth="200.0" style="-fx-padding: 10; -fx-background-radius: 5; -fx-font-size: 14px;" />
                        </VBox>
                        <VBox spacing="8.0" alignment="BOTTOM_LEFT">
                            <Label text=" " />
                            <Button mnemonicParsing="false" onAction="#handleRequestReturn" style="-fx-background-color: #ffc107; -fx-text-fill: #2c3e50; -fx-padding: 12 24; -fx-background-radius: 5; -fx-font-weight: bold; -fx-font-size: 14px;" text="ðŸ“¤ Return Book" />
                        </VBox>
                    </HBox>
                    <Label fx:id="returnMessageLabel" style="-fx-text-fill: #dc3545; -fx-font-weight: bold; -fx-font-size: 14px;" wrapText="true" />
                </VBox>
            </VBox>

            <!-- Borrow Books View -->
            <VBox fx:id="borrowBooksView" spacing="20.0" visible="false" managed="false">
                <padding>
                    <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
                </padding>

                <!-- Search and Borrow Section -->
                <VBox spacing="15.0" style="-fx-background-color: #f0f8ff; -fx-padding: 25; -fx-background-radius: 10; -fx-border-color: #3498db; -fx-border-radius: 10;">
                    <Label text="ðŸ“ Search and Borrow Books" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;" />

                    <!-- Search Controls -->
                    <HBox spacing="20.0" alignment="CENTER_LEFT">
                        <VBox spacing="8.0">
                            <Label text="Book Name:" style="-fx-font-weight: bold; -fx-font-size: 14px;" />
                            <TextField fx:id="borrowSearchNameField" promptText="Search by book name..." prefWidth="200.0" style="-fx-padding: 10; -fx-background-radius: 5; -fx-font-size: 14px;" />
                        </VBox>
                        <VBox spacing="8.0">
                            <Label text="Genre:" style="-fx-font-weight: bold; -fx-font-size: 14px;" />
                            <TextField fx:id="borrowSearchGenreField" promptText="Search by genre..." prefWidth="150.0" style="-fx-padding: 10; -fx-background-radius: 5; -fx-font-size: 14px;" />
                        </VBox>
                        <VBox spacing="8.0" alignment="BOTTOM_LEFT">
                            <Label text=" " />
                            <HBox spacing="10.0">
                                <Button mnemonicParsing="false" onAction="#handleBorrowSearch" style="-fx-background-color: #28a745; -fx-text-fill: white; -fx-padding: 10 16; -fx-background-radius: 5; -fx-font-size: 14px;" text="ðŸ” Search" />
                                <Button mnemonicParsing="false" onAction="#handleBorrowClearSearch" style="-fx-background-color: #6c757d; -fx-text-fill: white; -fx-padding: 10 16; -fx-background-radius: 5; -fx-font-size: 14px;" text="Clear" />
                            </HBox>
                        </VBox>
                    </HBox>

                    <!-- Borrow Controls -->
                    <HBox spacing="20.0" alignment="CENTER_LEFT" style="-fx-background-color: #e8f5e8; -fx-padding: 15; -fx-background-radius: 8;">
                        <VBox spacing="8.0">
                            <Label text="Book ID to Borrow:" style="-fx-font-weight: bold; -fx-font-size: 14px;" />
                            <TextField fx:id="borrowBookIdField" promptText="Enter Book ID..." prefWidth="200.0" style="-fx-padding: 10; -fx-background-radius: 5; -fx-font-size: 14px;" />
                        </VBox>
                        <VBox spacing="8.0" alignment="BOTTOM_LEFT">
                            <Label text=" " />
                            <Button mnemonicParsing="false" onAction="#handleRequestBorrow" style="-fx-background-color: #28a745; -fx-text-fill: white; -fx-padding: 12 24; -fx-background-radius: 5; -fx-font-weight: bold; -fx-font-size: 14px;" text="ðŸ“– Borrow Book" />
                        </VBox>
                    </HBox>

                    <Label fx:id="borrowMessageLabel" style="-fx-text-fill: #28a745; -fx-font-weight: bold; -fx-font-size: 14px;" />
                </VBox>

                <!-- Books Table for Borrowing -->
                <VBox spacing="10.0" VBox.vgrow="ALWAYS">
                    <Label text="ðŸ“– Books Available for Borrowing" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;" />
                    <TableView fx:id="borrowBooksTable" style="-fx-background-radius: 10; -fx-border-color: #dee2e6; -fx-border-radius: 10;" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="borrowBookIdCol" prefWidth="100.0" text="Book ID" />
                            <TableColumn fx:id="borrowBookTitleCol" prefWidth="250.0" text="Title" />
                            <TableColumn fx:id="borrowBookAuthorCol" prefWidth="200.0" text="Author" />
                            <TableColumn fx:id="borrowBookGenreCol" prefWidth="150.0" text="Genre" />
                            <TableColumn fx:id="borrowBookAvailableCol" prefWidth="100.0" text="Available" />
                            <TableColumn fx:id="borrowBookRatingCol" prefWidth="80.0" text="Rating" />
                        </columns>
                        <columnResizePolicy>
                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                        </columnResizePolicy>
                    </TableView>
                </VBox>
            </VBox>
        </StackPane>
    </center>
</BorderPane>